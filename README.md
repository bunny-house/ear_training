# Ear Training Game

一个纯前端的初学者练耳闯关游戏，旨在帮助用户通过听音辨音提高音乐听觉能力。

## 功能需求 (Requirements)

1.  **技术栈**:
    *   使用 Vue 3 + Vite 构建。
    *   纯前端实现，无后端依赖。

2.  **游戏关卡设计**:
    *   **通用功能**:
        *   **计时功能**: 所有关卡在游戏过程中右上角显示本关卡已用时间，游戏结束后在显示分数的同时显示总用时。
        *   **参考音开关**: 除 Level 5（变化参考音）和 Level 8（移动调）外，其他关卡提供"不播放参考音"开关，开启后跳过播放参考音。
        *   **防重复约束**: 紧邻的前后两次练习不允许随机到完全一样的音或音序列。
        *   **反馈系统**: 
            *   **正确答案**: 用户选择正确的音符时，该音符显示为亮绿色（#4ed07d）。
            *   **错误答案**: 用户选择错误的音符时，该音符显示为红色（#ff6b6b）。
            *   **正确答案指示**: 当用户选错时，正确答案会以黄绿色（#9acd32）高亮显示，并带有发光效果，帮助用户快速识别正确答案。
            *   **序列模式**: 在序列和旋律听写模式中，正确位置的音符显示为亮绿色，错误位置的音符显示为红色，未正确选择的正确答案显示为黄绿色。
    *   **Level 0 (Pitch Comparison / 高低音辨别)**:
        *   **流程**: 依次播放两个不同音高的音符。
        *   **选项**: 提供"第一个音更高"和"第二个音更高"两个选项供用户选择。
        *   **规则**: 每轮10题，每题10分，满分100分。
        *   **约束**: 两个音的音高差距需有一定范围，避免过于接近难以分辨。
    *   **Level 1 (C Major / 白键)**:
        *   **流程**: 播放参考音 C4 (Do)，随后播放一个基于此调式的随机音符 (Re, Mi, Fa, Sol, La, Si, High Do)。
        *   **选项**: 提供 2(Re) 到 1'(High Do) 共7个选项供用户选择。
        *   **规则**: 每轮10题，每题10分，满分100分。
    *   **Level 2 (Two-Note Sequence / 双音序列)**:
        *   **流程**: 播放参考音 C4 (Do)，随后依次播放两个基于此调式的随机音符。
        *   **选项**: 提供 2(Re) 到 1'(High Do) 共7个选项，选项右上角显示序号标志(1, 2)表示用户点击顺序。
        *   **规则**: 每轮10题，满分100分。用户需按播放顺序依次点击对应选项，两个都正确得10分，只对一个得5分，都错得0分。
    *   **Level 3 (Three-Note Sequence / 三音序列)**:
        *   **流程**: 播放参考音 C4 (Do)，随后依次播放三个基于此调式的随机音符。
        *   **选项**: 提供 2(Re) 到 1'(High Do) 共7个选项，选项右上角显示序号标志(1, 2, 3)表示用户点击顺序。
        *   **规则**: 每轮10题，满分100分。用户需按播放顺序依次点击对应选项，计分按正确比例计算（全对10分，对2个约6.67分，对1个约3.33分）。
    *   **Level 9 (Short Melodic Dictation / 短旋律听写)**:
        *   **流程**: 播放参考音 C4 (Do)，随后播放一段简短的流行歌曲旋律（8个音及以下）。
        *   **选项**: 提供 2(Re) 到 1'(High Do) 共7个选项。
        *   **规则**: 每轮10题，满分100分。用户需按顺序正确点击旋律中的所有音符，计分按正确比例计算。
        *   **默认设置**: 默认不播放参考音。
    *   **Level 4 (Chromatic / 半音阶)**:
        *   **范围**: 在 Level 1 的基础上，增加该八度内的所有非白键（黑键/半音）内容。
        *   **选项**: 提供包含升/降号的完整12个音符选项（不含低音Do，含高八度Do）。
        *   **概率控制**: 练习需要调整黑键和白键音的占比，黑键占百分之70，白键百分之30。
    *   **Level 5 (Variable Reference / 变化参考音)**:
        *   **机制**: 参考音不再固定为 Do，可以是 Do, Re, Mi, Fa, Sol, La, Si 等任意音。
        *   **流程**: 系统播放一个参考音并告知其唱名（如 "这是 Sol"），随后播放目标音。
        *   **目标**: 用户需根据给定的参考音及其唱名，听辨出目标音的相对唱名。
        *   **选项**: 同 Level 4，使用完整的半音阶选项（不含低音Do，含高八度Do）。
        *   **概率控制**: 同 Level 4。
    *   **Level 6 (Chromatic Two-Note Sequence / 半音阶双音序列)**:
        *   **流程**: 播放参考音 C4 (Do)，随后依次播放两个基于半音阶的随机音符。
        *   **选项**: 同 Level 4，使用完整的半音阶选项（不含低音Do，含高八度Do）。
        *   **规则**: 每轮10题，满分100分。用户需按播放顺序依次点击对应选项，计分规则同 Level 2。
        *   **概率控制**: 同 Level 4。
    *   **Level 7 (Chromatic Three-Note Sequence / 半音阶三音序列)**:
        *   **流程**: 播放参考音 C4 (Do)，随后依次播放三个基于半音阶的随机音符。
        *   **选项**: 同 Level 4，使用完整的半音阶选项（不含低音Do，含高八度Do）。
        *   **规则**: 每轮10题，满分100分。用户需按播放顺序依次点击对应选项，计分规则同 Level 3。
        *   **概率控制**: 同 Level 4。
    *   **Level 8 (Movable Do / 移动调)**:
        *   **机制**: 引入"首调"概念。系统不再固定使用 C4 作为 Do。
        *   **流程**: 每一轮随机选择一个音高作为参考音 "Do"（例如 F4, G3 等），然后播放目标音。
        *   **目标**: 用户需要忽略绝对音高，根据参考音建立的调性中心，听辨出目标音的相对唱名（Do, Re, Mi...）。
        *   **选项**: 同 Level 4，使用完整的半音阶选项（不含低音Do，含高八度Do）。
        *   **概率控制**: 练习需要调整黑键和白键音的占比，黑键占百分之70，白键百分之30。

3.  **UI/UX**:
    *   **主界面**: 需要响应式布局，使用垂直节点地图（Node Map）展示关卡，而非线性列表。
    *   **关卡地图结构**: 关卡以垂直节点流图形式展示，从上到下布局，节点连接关系如下：
        *   0 → 1（顶部起始）
        *   1 → 2 → 3 → 9（左侧分支：旋律听写）
        *   1 → 4（右侧分支起始）
        *   4 → 6 → 7（右侧分支A：半音阶序列）
        *   4 → 5 → 8（右侧分支B：高级听辨）
        *   说明，逻辑结构大概是，白键识别，黑键识别，调式转换
    *   **节点地图布局规范**:
        *   **节点按钮样式**: 矩形按钮，尺寸为 90x60px（桌面端），圆角 8px，边框 2px。
        *   **垂直间距**: 节点之间的垂直间距约为 140px，保持紧凑但清晰的布局。
        *   **水平间距**: 分支节点之间的水平间距为 200px，确保分支清晰可辨。
        *   **分支布局规则**:
            *   当有三个分支时，采用左、中、右布局，中间分支位于中心位置。
            *   当有两个分支时，采用一左一右布局，对称分布。
        *   **节点状态**:
            *   已解锁节点：可点击，边框为主色调，悬停时有放大效果。
            *   已完成节点：背景色为主色调，文字为对比色。
            *   未解锁节点：半透明，不可点击。
        *   **连线样式**: 连线表示关卡之间的解锁关系，已解锁路径使用主色调高亮显示。
    *   **节点地图功能**: 
        *   节点以矩形按钮形式展示，表示关卡，连线表示关卡之间的解锁关系。
        *   用户需要按顺序完成前置关卡才能解锁后续关卡。
        *   节点地图采用垂直布局，清晰展示关卡之间的分支和路径关系。
    *   **本地化**: Level按钮介绍及进入后的介绍文案需全为中文。

4.  **音频系统**:
    *   使用 Web Audio API 生成音频。
    *   音色需模拟钢琴音色（使用波形合成，不依赖静态资源文件）。

## 约束与修正记录 (Constraints & Fixes)

1.  **UI/UX 设计**:
    *   **深色模式 (Dark Mode)**: 界面必须完整支持浏览器/系统的深色模式切换。
    *   **对比度要求**: 即使在深色模式下，白色琴键（White Keys）等浅色背景元素上的文字必须保持深色（如黑色），以确保可读性。页面其他常规按钮需根据模式反转颜色。
    *   **节点地图布局**:
        *   **节点按钮**: 矩形按钮，桌面端尺寸 90x60px，移动端自适应缩小。
        *   **间距规范**: 垂直间距约 140px，水平分支间距 200px。
        *   **分支布局**: 三个分支时采用左、中、右布局；两个分支时采用一左一右对称布局。
        *   **响应式设计**: 支持不同屏幕尺寸，小屏幕下节点和字体自动缩小。
    *   **交互体验**: 界面需美观，并提供合理的交互反馈（如听音状态、对错反馈、节点悬停效果）。
    *   **返回菜单按钮位置**: 所有关卡页面（包括关卡介绍页和游戏进行页）的返回菜单按钮均位于页面左上角，采用绝对定位，位置为 `top: -10px; left: -10px`，确保按钮易于访问且不遮挡主要内容。

2.  **浏览器策略兼容性**:
    *   **AudioContext 初始化**: 由于浏览器的自动播放策略（Autoplay Policy），`AudioContext` 的初始化或 `resume()` 必须在**用户产生交互（如点击按钮）的同步调用栈**中立即执行。不能仅将其放在异步回调（如 `setTimeout`）中，否则会导致首个音符无法播放。

## 未来规划 (Roadmap)

以下是进阶关卡的规划方向，旨在引导学习者从单音听辨过渡到更复杂的音乐元素听辨：

*   **Level 7 - 音程辨认 (Intervals)**
    *   **痛点**: 从"这个音叫什么"进阶到"这两个音离多远"。
    *   **玩法**: 取消参考音 Do，直接播放两个音。用户需判断其音程关系（如大三度、纯五度）。

*   **Level 8 - 和弦色彩/性质 (Chord Quality)**
    *   **痛点**: 能够分辨和声的情感色彩（开心、悲伤、紧张）。
    *   **玩法**: 同时播放三个音（和弦）。用户需判断和弦性质（大三和弦、小三和弦、减三和弦等）。

*   **Level 9 - 旋律听写 (Melodic Dictation)**
    *   **痛点**: 训练短时音乐记忆力。
    *   **玩法**: 播放由3-5个音组成的短旋律，用户需按顺序正确写出所有音符。

*   **Level 10 - 节奏听辨 (Rhythm)**
    *   **痛点**: 训练对时间维度的感知。
    *   **玩法**: 使用打击乐音色播放节奏型，用户需选择对应的节奏谱或描述（如切分音、三连音）。
