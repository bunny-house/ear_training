# 随机算法测试用例文档

本文档描述了为随机算法功能设计的测试用例。

## 测试文件结构

### 1. `src/utils/random.spec.js`
测试随机算法工具函数的核心功能。

### 2. `src/components/__tests__/EarTrainingGame.random.spec.js`
测试游戏组件中随机算法的集成和使用。

## 测试用例分类

### 一、randomSelect - 原始随机算法测试

#### 基本功能测试
- ✅ 应该从数组中随机选择一个元素
- ✅ 应该处理空数组
- ✅ 应该处理 null 或 undefined
- ✅ 应该处理单个元素数组
- ✅ 应该处理对象数组

#### 随机性测试
- ✅ 应该能够选择数组中的任何元素（通过多次运行验证随机性）

### 二、shuffle - 洗牌算法测试

#### 基本功能测试
- ✅ 应该返回一个新数组，不修改原数组
- ✅ 应该返回包含相同元素的数组
- ✅ 应该处理空数组
- ✅ 应该处理单个元素数组
- ✅ 应该处理字符串数组
- ✅ 应该处理对象数组

#### 洗牌效果测试
- ✅ 应该能够打乱数组顺序（通过多次运行验证）

### 三、randomSelectMultiple - 多选函数测试

#### 基本功能测试
- ✅ 应该选择指定数量的元素
- ✅ 应该返回不重复的元素
- ✅ 当 count 大于等于数组长度时，应该返回所有元素
- ✅ 应该处理 count 为 0
- ✅ 应该处理空数组
- ✅ 应该处理负数 count

### 四、selectFromShuffled - 从洗牌数组中选择测试

#### 基本功能测试
- ✅ 应该返回选中的元素和下一个索引
- ✅ 应该按顺序返回洗牌后的元素
- ✅ 当索引超出范围时应该重新洗牌
- ✅ 应该处理空数组

### 五、selectRandom - 统一选择函数测试

#### random 算法测试
- ✅ 应该使用原始随机算法
- ✅ 应该能够选择任何元素

#### shuffle 算法测试
- ✅ 应该使用洗牌算法
- ✅ 应该按顺序返回洗牌后的元素
- ✅ 当洗牌数组用尽时应该重新洗牌
- ✅ 应该为不同的上下文维护独立状态

#### 边界情况测试
- ✅ 应该处理空数组
- ✅ 应该处理 null 或 undefined
- ✅ 默认应该使用 random 算法

### 六、算法对比测试

- ✅ 两种算法都应该能够选择数组中的元素
- ✅ 洗牌算法应该确保所有元素都被选中（在足够多次调用后）

## 游戏组件集成测试

### 一、算法切换 UI 测试

- ✅ 应该显示算法选择下拉菜单
- ✅ 默认应该使用 random 算法
- ✅ 应该能够切换到 shuffle 算法
- ✅ 切换算法时应该重置洗牌上下文

### 二、洗牌上下文管理测试

- ✅ 应该初始化所有洗牌上下文
- ✅ 每个上下文应该有 shuffledArray 和 shuffleIndex
- ✅ 开始游戏时应该重置所有洗牌上下文

### 三、算法在生成函数中的应用测试

- ✅ generateTargetNote 应该根据算法类型选择音符
- ✅ generateTargetSequence 应该根据算法类型生成序列
- ✅ generateMelody 应该根据算法类型选择旋律
- ✅ generatePitchPair 应该根据算法类型生成音高对

### 四、特殊关卡测试

- ✅ Level 5 参考音选择应该根据算法类型选择
- ✅ Level 8 根音频率选择应该根据算法类型选择

### 五、算法切换行为测试

- ✅ 在游戏进行中切换算法应该不影响当前轮次
- ✅ 切换算法后下一轮应该使用新算法

### 六、边界情况测试

- ✅ 应该处理算法切换时的空数组情况
- ✅ 应该处理无效的算法类型

## 测试覆盖范围

### 功能覆盖
- ✅ 所有随机算法函数的基本功能
- ✅ 边界情况和错误处理
- ✅ 算法切换逻辑
- ✅ 上下文管理
- ✅ 各关卡中的算法应用

### 代码覆盖
- ✅ 所有导出函数的测试
- ✅ 主要分支逻辑的测试
- ✅ 错误处理路径的测试

## 运行测试

```bash
# 运行所有随机算法相关测试
npm test -- random.spec.js --run

# 运行特定测试文件
npm test -- random.spec.js --run
npm test -- EarTrainingGame.random.spec.js --run

# 运行所有测试
npm test

# 查看测试覆盖率
npm run test:coverage
```

## 测试统计

- **总测试数**: 51 个
- **工具函数测试**: 34 个
- **组件集成测试**: 17 个
- **测试通过率**: 100%

## 测试设计原则

1. **全面性**: 覆盖所有函数和主要功能路径
2. **边界测试**: 测试空数组、null、undefined 等边界情况
3. **随机性验证**: 通过多次运行验证随机算法的随机性
4. **集成测试**: 测试算法在游戏组件中的实际应用
5. **可维护性**: 测试代码清晰、易于理解和维护

## 未来扩展

可以考虑添加以下测试：

1. **性能测试**: 测试大量数据下的算法性能
2. **统计测试**: 验证随机分布的均匀性
3. **并发测试**: 测试多线程/异步环境下的行为
4. **压力测试**: 测试极端情况下的稳定性
